!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,a){return void 0===a&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(a)}:e(window.jQuery)}(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_]"}),e.extend(e.FE.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),e.FE.PLUGINS.table=function(t){function a(){var e=t.$tb.find('.fr-command[data-cmd="insertTable"]'),a=t.popups.get("table.insert");if(a||(a=n()),!a.hasClass("fr-active")){t.popups.refresh("table.insert"),t.popups.setContainer("table.insert",t.$tb);var l=e.offset().left+e.outerWidth()/2,r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("table.insert",l,r,e.outerHeight())}}function l(){var e=N();if(e){var a=t.popups.get("table.edit");a||(a=c()),t.popups.setContainer("table.edit",t.$sc);var l=Y(e),r=(l.left+l.right)/2,s=l.bottom;t.popups.show("table.edit",r,s,l.bottom-l.top),t.edit.isDisabled()&&(t.toolbar.disable(),t.$el.removeClass("fr-no-selection"),t.edit.on(),t.button.bulkRefresh(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell:last").get(0)),t.selection.restore())}}function r(){var e=N();if(e){var a=t.popups.get("table.colors");a||(a=d()),t.popups.setContainer("table.colors",t.$sc);var l=Y(e),r=(l.left+l.right)/2,s=l.bottom;u(),t.popups.show("table.colors",r,s,l.bottom-l.top)}}function s(){0===ve().length&&t.toolbar.enable()}function n(a){if(a)return t.popups.onHide("table.insert",function(){t.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseenter")}),!0;var l="";t.opts.tableInsertButtons.length>0&&(l='<div class="fr-buttons">'+t.button.buildList(t.opts.tableInsertButtons)+"</div>");var r={buttons:l,rows_columns:i()},s=t.popups.create("table.insert",r);return t.events.$on(s,"mouseenter",".fr-table-size .fr-select-table-size .fr-table-cell",function(t){o(e(t.currentTarget))},!0),f(s),s}function o(e){var a=e.data("row"),l=e.data("col"),r=e.parent();r.siblings(".fr-table-size-info").html(a+" &times; "+l),r.find("> span").removeClass("hover fr-active-item");for(var s=1;s<=t.opts.tableInsertMaxSize;s++)for(var n=0;n<=t.opts.tableInsertMaxSize;n++){var o=r.find('> span[data-row="'+s+'"][data-col="'+n+'"]');s<=a&&n<=l?o.addClass("hover"):s<=a+1||s<=2&&!t.helpers.isMobile()?o.css("display","inline-block"):s>2&&!t.helpers.isMobile()&&o.css("display","none")}e.addClass("fr-active-item")}function i(){for(var e='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',a=1;a<=t.opts.tableInsertMaxSize;a++){for(var l=1;l<=t.opts.tableInsertMaxSize;l++){var r="inline-block";a>2&&!t.helpers.isMobile()&&(r="none");var s="fr-table-cell ";1==a&&1==l&&(s+=" hover"),e+='<span class="fr-command '+s+'" tabIndex="-1" data-cmd="tableInsert" data-row="'+a+'" data-col="'+l+'" data-param1="'+a+'" data-param2="'+l+'" style="display: '+r+';" role="button"><span></span><span class="fr-sr-only">'+a+" &times; "+l+"&nbsp;&nbsp;&nbsp;</span></span>"}e+='<div class="new-line"></div>'}return e+="</div></div>"}function f(a){t.events.$on(a,"focus","[tabIndex]",function(t){o(e(t.currentTarget))}),t.events.on("popup.tab",function(a){var l=e(a.currentTarget);if(!t.popups.isVisible("table.insert")||!l.is("span, a"))return!0;var r,s=a.which;if(e.FE.KEYCODE.ARROW_UP==s||e.FE.KEYCODE.ARROW_DOWN==s||e.FE.KEYCODE.ARROW_LEFT==s||e.FE.KEYCODE.ARROW_RIGHT==s){if(l.is("span.fr-table-cell")){var n=l.parent().find("span.fr-table-cell"),i=n.index(l),f=t.opts.tableInsertMaxSize,c=i%f,d=Math.floor(i/f);e.FE.KEYCODE.ARROW_UP==s?d=Math.max(0,d-1):e.FE.KEYCODE.ARROW_DOWN==s?d=Math.min(t.opts.tableInsertMaxSize-1,d+1):e.FE.KEYCODE.ARROW_LEFT==s?c=Math.max(0,c-1):e.FE.KEYCODE.ARROW_RIGHT==s&&(c=Math.min(t.opts.tableInsertMaxSize-1,c+1));var p=d*f+c,h=e(n.get(p));o(h),t.events.disableBlur(),h.focus(),r=!1}}else e.FE.KEYCODE.ENTER==s&&(t.button.exec(l),r=!1);return!1===r&&(a.preventDefault(),a.stopPropagation()),r},!0)}function c(e){if(e)return t.popups.onHide("table.edit",s),!0;var a="";t.opts.tableEditButtons.length>0&&(a='<div class="fr-buttons">'+t.button.buildList(t.opts.tableEditButtons)+"</div>");var r={buttons:a},n=t.popups.create("table.edit",r);return t.events.$on(t.$wp,"scroll.table-edit",function(){t.popups.isVisible("table.edit")&&l()}),n}function d(){var e="";t.opts.tableColorsButtons.length>0&&(e='<div class="fr-buttons fr-table-colors-buttons">'+t.button.buildList(t.opts.tableColorsButtons)+"</div>");var a={buttons:e,colors:p()},l=t.popups.create("table.colors",a);return t.events.$on(t.$wp,"scroll.table-colors",function(){t.popups.isVisible("table.colors")&&r()}),h(l),l}function p(){for(var e='<div class="fr-table-colors">',a=0;a<t.opts.tableColors.length;a++)0!==a&&a%t.opts.tableColorsStep==0&&(e+="<br>"),"REMOVE"!=t.opts.tableColors[a]?e+='<span class="fr-command" style="background: '+t.opts.tableColors[a]+';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="'+t.opts.tableColors[a]+'"><span class="fr-sr-only">'+t.language.translate("Color")+" "+t.opts.tableColors[a]+"&nbsp;&nbsp;&nbsp;</span></span>":e+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'+t.language.translate("Clear Formatting")+'">'+t.icon.create("tableColorRemove")+'<span class="fr-sr-only">'+t.language.translate("Clear Formatting")+"</span></span>";return e+="</div>"}function h(a){t.events.on("popup.tab",function(l){var r=e(l.currentTarget);if(!t.popups.isVisible("table.colors")||!r.is("span"))return!0;var s=l.which,n=!0;if(e.FE.KEYCODE.TAB==s){var o=a.find(".fr-buttons");n=!t.accessibility.focusToolbar(o,!!l.shiftKey)}else if(e.FE.KEYCODE.ARROW_UP==s||e.FE.KEYCODE.ARROW_DOWN==s||e.FE.KEYCODE.ARROW_LEFT==s||e.FE.KEYCODE.ARROW_RIGHT==s){var i=r.parent().find("span.fr-command"),f=i.index(r),c=t.opts.colorsStep,d=Math.floor(i.length/c),p=f%c,h=Math.floor(f/c),u=h*c+p,b=d*c;e.FE.KEYCODE.ARROW_UP==s?u=((u-c)%b+b)%b:e.FE.KEYCODE.ARROW_DOWN==s?u=(u+c)%b:e.FE.KEYCODE.ARROW_LEFT==s?u=((u-1)%b+b)%b:e.FE.KEYCODE.ARROW_RIGHT==s&&(u=(u+1)%b);var g=e(i.get(u));t.events.disableBlur(),g.focus(),n=!1}else e.FE.KEYCODE.ENTER==s&&(t.button.exec(r),n=!1);return!1===n&&(l.preventDefault(),l.stopPropagation()),n},!0)}function u(){var e=t.popups.get("table.colors"),a=t.$el.find(".fr-selected-cell:first");e.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),e.find('span[data-param1="'+t.helpers.RGBToHex(a.css("background-color"))+'"]').addClass("fr-selected-color fr-active-item")}function b(a,l){var r,s,n='<table style="width: 100%;" class="fr-inserted-table"><tbody>',o=100/l;for(r=0;r<a;r++){for(n+="<tr>",s=0;s<l;s++)n+='<td style="width: '+o.toFixed(4)+'%;">',0===r&&0===s&&(n+=e.FE.MARKERS),n+="<br></td>";n+="</tr>"}n+="</tbody></table>",t.html.insert(n),t.selection.restore();var i=t.$el.find(".fr-inserted-table");i.removeClass("fr-inserted-table"),t.events.trigger("table.inserted",[i.get(0)])}function g(){if(ve().length>0){var e=we();t.selection.setBefore(e.get(0))||t.selection.setAfter(e.get(0)),t.selection.restore(),t.popups.hide("table.edit"),e.remove(),t.toolbar.enable()}}function m(){var t=we();if(t.length>0&&0===t.find("th").length){var a,r="<thead><tr>",s=0;for(t.find("tr:first > td").each(function(){var t=e(this);s+=parseInt(t.attr("colspan"),10)||1}),a=0;a<s;a++)r+="<th><br></th>";r+="</tr></thead>",t.prepend(r),l()}}function v(){var e=we(),a=e.find("thead");if(a.length>0)if(0===e.find("tbody tr").length)g();else if(a.remove(),ve().length>0)l();else{t.popups.hide("table.edit");var r=e.find("tbody tr:first td:first").get(0);r&&(t.selection.setAtEnd(r),t.selection.restore())}}function w(a){var r=we();if(r.length>0){if(t.$el.find("th.fr-selected-cell").length>0&&"above"==a)return;var s,n,o,i=N(),f=L(i);n="above"==a?f.min_i:f.max_i;var c="<tr>";for(s=0;s<i[n].length;s++)if("below"==a&&n<i.length-1&&i[n][s]==i[n+1][s]||"above"==a&&n>0&&i[n][s]==i[n-1][s]){if(0===s||s>0&&i[n][s]!=i[n][s-1]){var d=e(i[n][s]);d.attr("rowspan",parseInt(d.attr("rowspan"),10)+1)}}else c+="<td><br></td>";c+="</tr>",o=e(t.$el.find("th.fr-selected-cell").length>0&&"below"==a?r.find("tbody").not(r.find("table tbody")):r.find("tr").not(r.find("table tr")).get(n)),"below"==a?"TBODY"==o.prop("tagName")?o.prepend(c):o.after(c):"above"==a&&(o.before(c),t.popups.isVisible("table.edit")&&l())}}function E(){var a=we();if(a.length>0){var l,r,s,n=N(),o=L(n);if(0===o.min_i&&o.max_i==n.length-1)g();else{for(l=o.max_i;l>=o.min_i;l--){for(s=e(a.find("tr").not(a.find("table tr")).get(l)),r=0;r<n[l].length;r++)if(0===r||n[l][r]!=n[l][r-1]){var i=e(n[l][r]);if(parseInt(i.attr("rowspan"),10)>1){var f=parseInt(i.attr("rowspan"),10)-1;1==f?i.removeAttr("rowspan"):i.attr("rowspan",f)}if(l<n.length-1&&n[l][r]==n[l+1][r]&&(0===l||n[l][r]!=n[l-1][r])){for(var c=n[l][r],d=r;d>0&&n[l][d]==n[l][d-1];)d--;0===d?e(a.find("tr").not(a.find("table tr")).get(l+1)).prepend(c):e(n[l+1][d-1]).after(c)}}var p=s.parent();s.remove(),0===p.find("tr").length&&p.remove(),n=N(a)}D(0,n.length-1,0,n[0].length-1,a),o.min_i>0?t.selection.setAtEnd(n[o.min_i-1][0]):t.selection.setAtEnd(n[0][0]),t.selection.restore(),t.popups.hide("table.edit")}}}function C(a){var r=we();if(r.length>0){var s,n=N(),o=L(n);s="before"==a?o.min_j:o.max_j;var i,f=100/n[0].length,c=100/(n[0].length+1);r.find("th, td").each(function(){i=e(this),i.data("old-width",i.outerWidth()/r.outerWidth()*100)}),r.find("tr").not(r.find("table tr")).each(function(t){for(var l,r=e(this),o=0,i=0;o-1<s;){if(!(l=r.find("> th, > td").get(i))){l=null;break}l==n[t][o]?(o+=parseInt(e(l).attr("colspan"),10)||1,i++):(o+=parseInt(e(n[t][o]).attr("colspan"),10)||1,"after"==a&&(l=0===i?-1:r.find("> th, > td").get(i-1)))}var d=e(l);if("after"==a&&o-1>s||"before"==a&&s>0&&n[t][s]==n[t][s-1]){if(0===t||t>0&&n[t][s]!=n[t-1][s]){var p=parseInt(d.attr("colspan"),10)+1;d.attr("colspan",p),d.css("width",(d.data("old-width")*c/f+c).toFixed(4)+"%"),d.removeData("old-width")}}else{var h;h=r.find("th").length>0?'<th style="width: '+c.toFixed(4)+'%;"><br></th>':'<td style="width: '+c.toFixed(4)+'%;"><br></td>',-1==l?r.prepend(h):null==l?r.append(h):"before"==a?d.before(h):"after"==a&&d.after(h)}}),r.find("th, td").each(function(){i=e(this),i.data("old-width")&&(i.css("width",(i.data("old-width")*c/f).toFixed(4)+"%"),i.removeData("old-width"))}),t.popups.isVisible("table.edit")&&l()}}function R(){var a=we();if(a.length>0){var l,r,s,n=N(),o=L(n);if(0===o.min_j&&o.max_j==n[0].length-1)g();else{var i=100/n[0].length,f=100/(n[0].length-o.max_j+o.min_j-1);for(a.find("th, td").each(function(){s=e(this),s.hasClass("fr-selected-cell")||s.data("old-width",s.outerWidth()/a.outerWidth()*100)}),r=o.max_j;r>=o.min_j;r--)for(l=0;l<n.length;l++)if(0===l||n[l][r]!=n[l-1][r])if(s=e(n[l][r]),(parseInt(s.attr("colspan"),10)||1)>1){var c=parseInt(s.attr("colspan"),10)-1;1==c?s.removeAttr("colspan"):s.attr("colspan",c),s.css("width",((s.data("old-width")-ce(r,n))*f/i).toFixed(4)+"%"),s.removeData("old-width")}else{var d=e(s.parent().get(0));s.remove(),0===d.find("> th, > td").length&&(0===d.prev().length||0===d.next().length||d.prev().find("> th[rowspan], > td[rowspan]").length<d.prev().find("> th, > td").length)&&d.remove()}D(0,n.length-1,0,n[0].length-1,a),o.min_j>0?t.selection.setAtEnd(n[o.min_i][o.min_j-1]):t.selection.setAtEnd(n[o.min_i][0]),t.selection.restore(),t.popups.hide("table.edit"),a.find("th, td").each(function(){s=e(this),s.data("old-width")&&(s.css("width",(s.data("old-width")*f/i).toFixed(4)+"%"),s.removeData("old-width"))})}}}function O(e,t,a){var l,r,s,n,o,i=0,f=N(a);for(t=Math.min(t,f[0].length-1),r=e;r<=t;r++)if(!(r>e&&f[0][r]==f[0][r-1])&&(n=parseInt(f[0][r].getAttribute("colspan"),10)||1)>1&&f[0][r]==f[0][r+1])for(i=n-1,l=1;l<f.length;l++)if(f[l][r]!=f[l-1][r]){for(s=r;s<r+n;s++)if((o=parseInt(f[l][s].getAttribute("colspan"),10)||1)>1&&f[l][s]==f[l][s+1])i=Math.min(i,o-1),s+=i;else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&F(f,i,"colspan",0,f.length-1,e,t)}function A(e,t,a){var l,r,s,n,o,i=0,f=N(a);for(t=Math.min(t,f.length-1),l=e;l<=t;l++)if(!(l>e&&f[l][0]==f[l-1][0])&&(n=parseInt(f[l][0].getAttribute("rowspan"),10)||1)>1&&f[l][0]==f[l+1][0])for(i=n-1,r=1;r<f[0].length;r++)if(f[l][r]!=f[l][r-1]){for(s=l;s<l+n;s++)if((o=parseInt(f[s][r].getAttribute("rowspan"),10)||1)>1&&f[s][r]==f[s+1][r])i=Math.min(i,o-1),s+=i;else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&F(f,i,"rowspan",e,t,0,f[0].length-1)}function F(e,t,a,l,r,s,n){var o,i,f;for(o=l;o<=r;o++)for(i=s;i<=n;i++)o>l&&e[o][i]==e[o-1][i]||i>s&&e[o][i]==e[o][i-1]||(f=parseInt(e[o][i].getAttribute(a),10)||1)>1&&(f-t>1?e[o][i].setAttribute(a,f-t):e[o][i].removeAttribute(a))}function D(e,t,a,l,r){A(e,t,r),O(a,l,r)}function x(){if(ve().length>1&&(0===t.$el.find("th.fr-selected-cell").length||0===t.$el.find("td.fr-selected-cell").length)){B();var a,r,s=N(),n=L(s),o=t.$el.find(".fr-selected-cell"),i=e(o[0]),f=i.parent(),c=f.find(".fr-selected-cell"),d=i.closest("table"),p=i.html(),h=0;for(a=0;a<c.length;a++)h+=e(c[a]).outerWidth();for(i.css("width",(h/d.outerWidth()*100).toFixed(4)+"%"),n.min_j<n.max_j&&i.attr("colspan",n.max_j-n.min_j+1),n.min_i<n.max_i&&i.attr("rowspan",n.max_i-n.min_i+1),a=1;a<o.length;a++)r=e(o[a]),"<br>"!=r.html()&&""!==r.html()&&(p+="<br>"+r.html()),r.remove();i.html(p),t.selection.setAtEnd(i.get(0)),t.selection.restore(),t.toolbar.enable(),A(n.min_i,n.max_i,d);var u=d.find("tr:empty");for(a=u.length-1;a>=0;a--)e(u[a]).remove();O(n.min_j,n.max_j,d),l()}}function y(){if(1==ve().length){var a=t.$el.find(".fr-selected-cell"),l=a.parent(),r=a.closest("table"),s=parseInt(a.attr("rowspan"),10),n=N(),o=S(a.get(0),n),i=a.clone().html("<br>");if(s>1){var f=Math.ceil(s/2);f>1?a.attr("rowspan",f):a.removeAttr("rowspan"),s-f>1?i.attr("rowspan",s-f):i.removeAttr("rowspan");for(var c=o.row+f,d=0===o.col?o.col:o.col-1;d>=0&&(n[c][d]==n[c][d-1]||c>0&&n[c][d]==n[c-1][d]);)d--;-1==d?e(r.find("tr").not(r.find("table tr")).get(c)).prepend(i):e(n[c][d]).after(i)}else{var p,h=e("<tr>").append(i);for(p=0;p<n[0].length;p++)if(0===p||n[o.row][p]!=n[o.row][p-1]){var u=e(n[o.row][p]);u.is(a)||u.attr("rowspan",(parseInt(u.attr("rowspan"),10)||1)+1)}l.after(h)}k(),t.popups.hide("table.edit")}}function _(){if(1==ve().length){var a=t.$el.find(".fr-selected-cell"),l=parseInt(a.attr("colspan"),10)||1,r=a.parent().outerWidth(),s=a.outerWidth(),n=a.clone().html("<br>"),o=N(),i=S(a.get(0),o);if(l>1){var f=Math.ceil(l/2);s=de(i.col,i.col+f-1,o)/r*100;var c=de(i.col+f,i.col+l-1,o)/r*100;f>1?a.attr("colspan",f):a.removeAttr("colspan"),l-f>1?n.attr("colspan",l-f):n.removeAttr("colspan"),a.css("width",s.toFixed(4)+"%"),n.css("width",c.toFixed(4)+"%")}else{var d;for(d=0;d<o.length;d++)if(0===d||o[d][i.col]!=o[d-1][i.col]){var p=e(o[d][i.col]);if(!p.is(a)){var h=(parseInt(p.attr("colspan"),10)||1)+1;p.attr("colspan",h)}}s=s/r*100/2,a.css("width",s.toFixed(4)+"%"),n.css("width",s.toFixed(4)+"%")}a.after(n),k(),t.popups.hide("table.edit")}}function M(e){"REMOVE"!=e?t.$el.find(".fr-selected-cell").css("background-color",t.helpers.HEXtoRGB(e)):t.$el.find(".fr-selected-cell").css("background-color","")}function I(e){t.$el.find(".fr-selected-cell").css("vertical-align",e)}function $(e){t.$el.find(".fr-selected-cell").css("text-align",e)}function T(e,t,a,l){if(t.length>0){if(!a){var r=Object.keys(l);r.splice(r.indexOf(e),1),t.removeClass(r.join(" "))}t.toggleClass(e)}}function N(t){t=t||null;var a=[];if(null==t&&ve().length>0&&(t=we()),t)return t.find("tr").not(t.find("table tr")).each(function(t,l){var r=e(l),s=0;r.find("> th, > td").each(function(l,r){for(var n=e(r),o=parseInt(n.attr("colspan"),10)||1,i=parseInt(n.attr("rowspan"),10)||1,f=t;f<t+i;f++)for(var c=s;c<s+o;c++)a[f]||(a[f]=[]),a[f][c]?s++:a[f][c]=r;s+=o})}),a}function S(e,t){for(var a=0;a<t.length;a++)for(var l=0;l<t[a].length;l++)if(t[a][l]==e)return{row:a,col:l}}function z(e,t,a){for(var l=e+1,r=t+1;l<a.length;){if(a[l][t]!=a[e][t]){l--;break}l++}for(l==a.length&&l--;r<a[e].length;){if(a[e][r]!=a[e][t]){r--;break}r++}return r==a[e].length&&r--,{row:l,col:r}}function B(){t.el.querySelector(".fr-cell-fixed")&&t.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),t.el.querySelector(".fr-cell-handler")&&t.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function k(){var a=t.$el.find(".fr-selected-cell");a.length>0&&a.each(function(){var t=e(this);t.removeClass("fr-selected-cell"),""===t.attr("class")&&t.removeAttr("class")}),B()}function W(){setTimeout(function(){t.selection.clear(),t.$el.addClass("fr-no-selection"),t.$el.blur()},0)}function L(e){var a=t.$el.find(".fr-selected-cell");if(a.length>0){var l,r=e.length,s=0,n=e[0].length,o=0;for(l=0;l<a.length;l++){var i=S(a[l],e),f=z(i.row,i.col,e);r=Math.min(i.row,r),s=Math.max(f.row,s),n=Math.min(i.col,n),o=Math.max(f.col,o)}return{min_i:r,max_i:s,min_j:n,max_j:o}}return null}function K(t,a,l,r,s){var n,o,i,f,c=t,d=a,p=l,h=r;for(n=c;n<=d;n++)((parseInt(e(s[n][p]).attr("rowspan"),10)||1)>1||(parseInt(e(s[n][p]).attr("colspan"),10)||1)>1)&&(i=S(s[n][p],s),f=z(i.row,i.col,s),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h)),((parseInt(e(s[n][h]).attr("rowspan"),10)||1)>1||(parseInt(e(s[n][h]).attr("colspan"),10)||1)>1)&&(i=S(s[n][h],s),f=z(i.row,i.col,s),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h));for(o=p;o<=h;o++)((parseInt(e(s[c][o]).attr("rowspan"),10)||1)>1||(parseInt(e(s[c][o]).attr("colspan"),10)||1)>1)&&(i=S(s[c][o],s),f=z(i.row,i.col,s),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h)),((parseInt(e(s[d][o]).attr("rowspan"),10)||1)>1||(parseInt(e(s[d][o]).attr("colspan"),10)||1)>1)&&(i=S(s[d][o],s),f=z(i.row,i.col,s),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h));return c==t&&d==a&&p==l&&h==r?{min_i:t,max_i:a,min_j:l,max_j:r}:K(c,d,p,h,s)}function Y(t){var a=L(t),l=e(t[a.min_i][a.min_j]),r=e(t[a.min_i][a.max_j]),s=e(t[a.max_i][a.min_j]);return{left:l.offset().left,right:r.offset().left+r.outerWidth(),top:l.offset().top,bottom:s.offset().top+s.outerHeight()}}function H(a,l){if(e(a).is(l))k(),t.edit.on(),e(a).addClass("fr-selected-cell");else{W(),t.edit.off();var r=N(),s=S(a,r),n=S(l,r),o=K(Math.min(s.row,n.row),Math.max(s.row,n.row),Math.min(s.col,n.col),Math.max(s.col,n.col),r);k(),a.classList.add("fr-cell-fixed"),l.classList.add("fr-cell-handler");for(var i=o.min_i;i<=o.max_i;i++)for(var f=o.min_j;f<=o.max_j;f++)e(r[i][f]).addClass("fr-selected-cell")}}function P(a){var l=null,r=e(a.target);return"TD"==a.target.tagName||"TH"==a.target.tagName?l=a.target:r.closest("td").length>0?l=r.closest("td").get(0):r.closest("th").length>0&&(l=r.closest("th").get(0)),0===t.$el.find(l).length?null:l}function j(){k(),t.popups.hide("table.edit")}function V(a){var l=P(a);if(ve().length>0&&!l&&j(),!t.edit.isDisabled()||t.popups.isVisible("table.edit"))if(1!=a.which||1==a.which&&t.helpers.isMac()&&a.ctrlKey)(3==a.which||1==a.which&&t.helpers.isMac()&&a.ctrlKey)&&l&&j();else if(De=!0,l){ve().length>0&&!a.shiftKey&&j(),a.stopPropagation(),t.events.trigger("image.hideResizer"),t.events.trigger("video.hideResizer"),Fe=!0;var r=l.tagName.toLowerCase();a.shiftKey&&t.$el.find(r+".fr-selected-cell").length>0?e(t.$el.find(r+".fr-selected-cell").closest("table")).is(e(l).closest("table"))?H(xe,l):W():((t.keys.ctrlKey(a)||a.shiftKey)&&(ve().length>1||0===e(l).find(t.selection.element()).length&&!e(l).is(t.selection.element()))&&W(),xe=l,H(xe,xe))}}function X(a){if(Fe||t.$tb.is(a.target)||t.$tb.is(e(a.target).closest(t.$tb.get(0)))||(ve().length>0&&t.toolbar.enable(),k()),!(1!=a.which||1==a.which&&t.helpers.isMac()&&a.ctrlKey)&&(De=!1,Fe&&(Fe=!1,P(a)||1!=ve().length?ve().length>0&&(t.selection.isCollapsed()?l():k()):k()),_e)){_e=!1,Oe.removeClass("fr-moving"),t.$el.removeClass("fr-no-selection"),t.edit.on();var r=parseFloat(Oe.css("left"))+t.opts.tableResizerOffset;t.opts.iframe&&(r-=t.$iframe.offset().left),Oe.data("release-position",r),Oe.removeData("max-left"),Oe.removeData("max-right"),fe(a),te()}}function U(a){if(!0===Fe){if(e(a.currentTarget).closest("table").is(we())){if("TD"==a.currentTarget.tagName&&0===t.$el.find("th.fr-selected-cell").length)return void H(xe,a.currentTarget);if("TH"==a.currentTarget.tagName&&0===t.$el.find("td.fr-selected-cell").length)return void H(xe,a.currentTarget)}W()}}function q(a,l){for(var r=a;r&&"TABLE"!=r.tagName&&r.parentNode!=t.el;)r=r.parentNode;if(r&&"TABLE"==r.tagName){var s=N(e(r));"up"==l?J(S(a,s),r,s):"down"==l&&Q(S(a,s),r,s)}}function G(e,a,l,r){for(var s,n=a;n!=t.el&&"TD"!=n.tagName&&"TH"!=n.tagName&&("up"==r?s=n.previousElementSibling:"down"==r&&(s=n.nextElementSibling),!s);)n=n.parentNode;"TD"==n.tagName||"TH"==n.tagName?q(n,r):s&&("up"==r&&t.selection.setAtEnd(s),"down"==r&&t.selection.setAtStart(s))}function J(e,a,l){e.row>0?t.selection.setAtEnd(l[e.row-1][e.col]):G(e,a,l,"up")}function Q(e,a,l){var r=parseInt(l[e.row][e.col].getAttribute("rowspan"),10)||1;e.row<l.length-r?t.selection.setAtStart(l[e.row+r][e.col]):G(e,a,l,"down")}function Z(a){var l=a.which,r=t.selection.blocks();if(r.length&&(r=r[0],"TD"==r.tagName||"TH"==r.tagName)){for(var s=r;s&&"TABLE"!=s.tagName&&s.parentNode!=t.el;)s=s.parentNode;if(s&&"TABLE"==s.tagName&&(e.FE.KEYCODE.ARROW_LEFT==l||e.FE.KEYCODE.ARROW_UP==l||e.FE.KEYCODE.ARROW_RIGHT==l||e.FE.KEYCODE.ARROW_DOWN==l)&&(ve().length>0&&j(),t.browser.webkit&&(e.FE.KEYCODE.ARROW_UP==l||e.FE.KEYCODE.ARROW_DOWN==l))){var n=t.selection.ranges(0).startContainer;if(n.nodeType==Node.TEXT_NODE&&(e.FE.KEYCODE.ARROW_UP==l&&n.previousSibling||e.FE.KEYCODE.ARROW_DOWN==l&&n.nextSibling))return;a.preventDefault(),a.stopPropagation();var o=N(e(s)),i=S(r,o);return e.FE.KEYCODE.ARROW_UP==l?J(i,s,o):e.FE.KEYCODE.ARROW_DOWN==l&&Q(i,s,o),t.selection.restore(),!1}}}function ee(){t.shared.$table_resizer||(t.shared.$table_resizer=e('<div class="fr-table-resizer"><div></div></div>')),Oe=t.shared.$table_resizer,t.events.$on(Oe,"mousedown",function(e){return!t.core.sameInstance(Oe)||(ve().length>0&&j(),1==e.which?(t.selection.save(),_e=!0,Oe.addClass("fr-moving"),W(),t.edit.off(),Oe.find("div").css("opacity",1),!1):void 0)}),t.events.$on(Oe,"mousemove",function(e){if(!t.core.sameInstance(Oe))return!0;_e&&(t.opts.iframe&&(e.pageX-=t.$iframe.offset().left),pe(e))}),t.events.on("shared.destroy",function(){Oe.html("").removeData().remove(),Oe=null},!0),t.events.on("destroy",function(){t.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),Oe.hide().appendTo(e("body:first"))},!0)}function te(){Oe&&(Oe.find("div").css("opacity",0),Oe.css("top",0),Oe.css("left",0),Oe.css("height",0),Oe.find("div").css("height",0),Oe.hide())}function ae(){Ae&&Ae.removeClass("fr-visible").css("left","-9999px")}function le(a,l){var r=e(l),s=r.closest("table"),n=s.parent();if(l&&"TD"!=l.tagName&&"TH"!=l.tagName&&(r.closest("td").length>0?l=r.closest("td"):r.closest("th").length>0&&(l=r.closest("th"))),!l||"TD"!=l.tagName&&"TH"!=l.tagName)Oe&&r.get(0)!=Oe.get(0)&&r.parent().get(0)!=Oe.get(0)&&t.core.sameInstance(Oe)&&te();else{if(r=e(l),0===t.$el.find(r).length)return!1;var o=r.offset().left-1,i=o+r.outerWidth();if(Math.abs(a.pageX-o)<=t.opts.tableResizerOffset||Math.abs(i-a.pageX)<=t.opts.tableResizerOffset){var f,c,d,p,h,u=N(s),b=S(l,u),g=z(b.row,b.col,u),m=s.offset().top,v=s.outerHeight()-1;"rtl"!=t.opts.direction?a.pageX-o<=t.opts.tableResizerOffset?(d=o,b.col>0?(p=o-ce(b.col-1,u)+t.opts.tableResizingLimit,h=o+ce(b.col,u)-t.opts.tableResizingLimit,f=b.col-1,c=b.col):(f=null,c=0,p=s.offset().left-1-parseInt(s.css("margin-left"),10),h=s.offset().left-1+s.width()-u[0].length*t.opts.tableResizingLimit)):i-a.pageX<=t.opts.tableResizerOffset&&(d=i,g.col<u[g.row].length&&u[g.row][g.col+1]?(p=i-ce(g.col,u)+t.opts.tableResizingLimit,h=i+ce(g.col+1,u)-t.opts.tableResizingLimit,f=g.col,c=g.col+1):(f=g.col,c=null,p=s.offset().left-1+u[0].length*t.opts.tableResizingLimit,h=n.offset().left-1+n.width()+parseFloat(n.css("padding-left")))):i-a.pageX<=t.opts.tableResizerOffset?(d=i,b.col>0?(p=i-ce(b.col,u)+t.opts.tableResizingLimit,h=i+ce(b.col-1,u)-t.opts.tableResizingLimit,f=b.col,c=b.col-1):(f=null,c=0,p=s.offset().left+u[0].length*t.opts.tableResizingLimit,h=n.offset().left-1+n.width()+parseFloat(n.css("padding-left")))):a.pageX-o<=t.opts.tableResizerOffset&&(d=o,g.col<u[g.row].length&&u[g.row][g.col+1]?(p=o-ce(g.col+1,u)+t.opts.tableResizingLimit,h=o+ce(g.col,u)-t.opts.tableResizingLimit,f=g.col+1,c=g.col):(f=g.col,c=null,p=n.offset().left+parseFloat(n.css("padding-left")),h=s.offset().left-1+s.width()-u[0].length*t.opts.tableResizingLimit)),Oe||ee(),Oe.data("table",s),Oe.data("first",f),Oe.data("second",c),Oe.data("instance",t),t.$wp.append(Oe);var w=d-t.win.pageXOffset-t.opts.tableResizerOffset,E=m-t.win.pageYOffset;t.opts.iframe&&(w+=t.$iframe.offset().left-t.helpers.scrollLeft(),E+=t.$iframe.offset().top-t.helpers.scrollTop(),p+=t.$iframe.offset().left,h+=t.$iframe.offset().left),Oe.data("max-left",p),Oe.data("max-right",h),Oe.data("origin",d-t.win.pageXOffset),Oe.css("top",E),Oe.css("left",w),Oe.css("height",v),Oe.find("div").css("height",v),Oe.css("padding-left",t.opts.tableResizerOffset),Oe.css("padding-right",t.opts.tableResizerOffset),Oe.show()}else t.core.sameInstance(Oe)&&te()}}function re(a,l){if(t.$box.find(".fr-line-breaker").is(":visible"))return!1;Ae||be(),t.$box.append(Ae),Ae.data("instance",t);var r=e(l),s=r.find("tr:first"),n=a.pageX,o=0,i=0;t.opts.iframe&&(o+=t.$iframe.offset().left-t.helpers.scrollLeft(),i+=t.$iframe.offset().top-t.helpers.scrollTop());var f;s.find("th, td").each(function(){var a=e(this);return a.offset().left<=n&&n<a.offset().left+a.outerWidth()/2?(f=parseInt(Ae.find("a").css("width"),10),Ae.css("top",i+a.offset().top-t.win.pageYOffset-f-5),Ae.css("left",o+a.offset().left-t.win.pageXOffset-f/2),Ae.data("selected-cell",a),Ae.data("position","before"),Ae.addClass("fr-visible"),!1):a.offset().left+a.outerWidth()/2<=n&&n<a.offset().left+a.outerWidth()?(f=parseInt(Ae.find("a").css("width"),10),Ae.css("top",i+a.offset().top-t.win.pageYOffset-f-5),Ae.css("left",o+a.offset().left+a.outerWidth()-t.win.pageXOffset-f/2),Ae.data("selected-cell",a),Ae.data("position","after"),Ae.addClass("fr-visible"),!1):void 0})}function se(a,l){if(t.$box.find(".fr-line-breaker").is(":visible"))return!1;Ae||be(),t.$box.append(Ae),Ae.data("instance",t);var r=e(l),s=a.pageY,n=0,o=0;t.opts.iframe&&(n+=t.$iframe.offset().left-t.helpers.scrollLeft(),o+=t.$iframe.offset().top-t.helpers.scrollTop());var i;r.find("tr").each(function(){var a=e(this);return a.offset().top<=s&&s<a.offset().top+a.outerHeight()/2?(i=parseInt(Ae.find("a").css("width"),10),Ae.css("top",o+a.offset().top-t.win.pageYOffset-i/2),Ae.css("left",n+a.offset().left-t.win.pageXOffset-i-5),Ae.data("selected-cell",a.find("td:first")),Ae.data("position","above"),Ae.addClass("fr-visible"),!1):a.offset().top+a.outerHeight()/2<=s&&s<a.offset().top+a.outerHeight()?(i=parseInt(Ae.find("a").css("width"),10),Ae.css("top",o+a.offset().top+a.outerHeight()-t.win.pageYOffset-i/2),Ae.css("left",n+a.offset().left-t.win.pageXOffset-i-5),Ae.data("selected-cell",a.find("td:first")),Ae.data("position","below"),Ae.addClass("fr-visible"),!1):void 0})}function ne(a,l){if(0===ve().length){var r,s,n;if(l&&("HTML"==l.tagName||"BODY"==l.tagName||t.node.isElement(l)))for(r=1;r<=t.opts.tableInsertHelperOffset;r++){if(s=t.doc.elementFromPoint(a.pageX-t.win.pageXOffset,a.pageY-t.win.pageYOffset+r),e(s).hasClass("fr-tooltip"))return!0;if(s&&("TH"==s.tagName||"TD"==s.tagName||"TABLE"==s.tagName)&&(e(s).parents(".fr-wrapper").length||t.opts.iframe))return re(a,e(s).closest("table")),!0;if(n=t.doc.elementFromPoint(a.pageX-t.win.pageXOffset+r,a.pageY-t.win.pageYOffset),e(n).hasClass("fr-tooltip"))return!0;if(n&&("TH"==n.tagName||"TD"==n.tagName||"TABLE"==n.tagName)&&(e(n).parents(".fr-wrapper").length||t.opts.iframe))return se(a,e(n).closest("table")),!0}t.core.sameInstance(Ae)&&ae()}}function oe(e){ye=null;var a=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset);t.opts.tableResizer&&(!t.popups.areVisible()||t.popups.areVisible()&&t.popups.isVisible("table.edit"))&&le(e,a),!t.opts.tableInsertHelper||t.popups.areVisible()||t.$tb.hasClass("fr-inline")&&t.$tb.is(":visible")||ne(e,a)}function ie(){if(_e){var e=Oe.data("table"),a=e.offset().top-t.win.pageYOffset;t.opts.iframe&&(a+=t.$iframe.offset().top-t.helpers.scrollTop()),Oe.css("top",a)}}function fe(){var a=Oe.data("origin"),l=Oe.data("release-position");if(a!==l){var r=Oe.data("first"),s=Oe.data("second"),n=Oe.data("table"),o=n.outerWidth();if(t.undo.canDo()||t.undo.saveStep(),null!==r&&null!==s){var i,f,c,d=N(n),p=[],h=[],u=[],b=[];for(i=0;i<d.length;i++)f=e(d[i][r]),c=e(d[i][s]),p[i]=f.outerWidth(),u[i]=c.outerWidth(),h[i]=p[i]/o*100,b[i]=u[i]/o*100;for(i=0;i<d.length;i++){f=e(d[i][r]),c=e(d[i][s]);var g=(h[i]*(p[i]+l-a)/p[i]).toFixed(4);f.css("width",g+"%"),c.css("width",(h[i]+b[i]-g).toFixed(4)+"%")}}else{var m,v=n.parent(),w=o/v.width()*100,E=(parseInt(n.css("margin-left"),10)||0)/v.width()*100,C=(parseInt(n.css("margin-right"),10)||0)/v.width()*100;"rtl"==t.opts.direction&&0===s||"rtl"!=t.opts.direction&&0!==s?(m=(o+l-a)/o*w,n.css("margin-right","calc(100% - "+Math.round(m).toFixed(4)+"% - "+Math.round(E).toFixed(4)+"%)")):("rtl"==t.opts.direction&&0!==s||"rtl"!=t.opts.direction&&0===s)&&(m=(o-l+a)/o*w,n.css("margin-left","calc(100% - "+Math.round(m).toFixed(4)+"% - "+Math.round(C).toFixed(4)+"%)")),n.css("width",Math.round(m).toFixed(4)+"%")}t.selection.restore(),t.undo.saveStep()}Oe.removeData("origin"),Oe.removeData("release-position"),Oe.removeData("first"),Oe.removeData("second"),Oe.removeData("table")}function ce(t,a){var l,r=e(a[0][t]).outerWidth();for(l=1;l<a.length;l++)r=Math.min(r,e(a[l][t]).outerWidth());return r}function de(e,t,a){var l,r=0;for(l=e;l<=t;l++)r+=ce(l,a);return r}function pe(e){if(ve().length>1&&De&&W(),!1===De&&!1===Fe&&!1===_e)ye&&clearTimeout(ye),t.edit.isDisabled()&&!t.popups.isVisible("table.edit")||(ye=setTimeout(oe,30,e));else if(_e){var a=e.pageX-t.win.pageXOffset;t.opts.iframe&&(a+=t.$iframe.offset().left);var l=Oe.data("max-left"),r=Oe.data("max-right");a>=l&&a<=r?Oe.css("left",a-t.opts.tableResizerOffset):a<l&&parseFloat(Oe.css("left"),10)>l-t.opts.tableResizerOffset?Oe.css("left",l-t.opts.tableResizerOffset):a>r&&parseFloat(Oe.css("left"),10)<r-t.opts.tableResizerOffset&&Oe.css("left",r-t.opts.tableResizerOffset)}else De&&ae()}function he(a){t.node.isEmpty(a.get(0))?a.prepend(e.FE.MARKERS):a.prepend(e.FE.START_MARKER).append(e.FE.END_MARKER)}function ue(a){if(a.which==e.FE.KEYCODE.TAB){var l;if(ve().length>0)l=t.$el.find(".fr-selected-cell:last");else{var r=t.selection.element();"TD"==r.tagName||"TH"==r.tagName?l=e(r):r!=t.el&&(e(r).parentsUntil(t.$el,"td").length>0?l=e(r).parents("td:first"):e(r).parentsUntil(t.$el,"th").length>0&&(l=e(r).parents("th:first")))}if(l)return a.preventDefault(),e(t.selection.element()).parents("ol, ul").length>0||(j(),a.shiftKey?l.prev().length>0?he(l.prev()):l.closest("tr").length>0&&l.closest("tr").prev().length>0?he(l.closest("tr").prev().find("td:last")):l.closest("tbody").length>0&&l.closest("table").find("thead tr").length>0&&he(l.closest("table").find("thead tr th:last")):l.next().length>0?he(l.next()):l.closest("tr").length>0&&l.closest("tr").next().length>0?he(l.closest("tr").next().find("td:first")):l.closest("thead").length>0&&l.closest("table").find("tbody tr").length>0?he(l.closest("table").find("tbody tr td:first")):(l.addClass("fr-selected-cell"),w("below"),k(),he(l.closest("tr").next().find("td:first"))),t.selection.restore(),!1)}}function be(){
t.shared.$ti_helper||(t.shared.$ti_helper=e('<div class="fr-insert-helper"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+t.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a></div>'),t.events.bindClick(t.shared.$ti_helper,"a",function(){var e=Ae.data("selected-cell"),a=Ae.data("position"),l=Ae.data("instance")||t;"before"==a?(e.addClass("fr-selected-cell"),l.table.insertColumn(a),e.removeClass("fr-selected-cell")):"after"==a?(e.addClass("fr-selected-cell"),l.table.insertColumn(a),e.removeClass("fr-selected-cell")):"above"==a?(e.addClass("fr-selected-cell"),l.table.insertRow(a),e.removeClass("fr-selected-cell")):"below"==a&&(e.addClass("fr-selected-cell"),l.table.insertRow(a),e.removeClass("fr-selected-cell")),ae()}),t.events.on("shared.destroy",function(){t.shared.$ti_helper.html("").removeData().remove(),t.shared.$ti_helper=null},!0),t.events.$on(t.shared.$ti_helper,"mousemove",function(e){e.stopPropagation()},!0),t.events.$on(e(t.o_win),"scroll",function(){ae()},!0),t.events.$on(t.$wp,"scroll",function(){ae()},!0)),Ae=t.shared.$ti_helper,t.events.on("destroy",function(){Ae=null}),t.tooltip.bind(t.$box,".fr-insert-helper > a.fr-floating-btn")}function ge(){xe=null,clearTimeout(ye)}function me(){ve().length>0?l():(t.popups.hide("table.insert"),t.toolbar.showInline())}function ve(){return t.el.querySelectorAll(".fr-selected-cell")}function we(){var a=ve();if(a.length){for(var l=a[0];l&&"TABLE"!=l.tagName&&l.parentNode!=t.el;)l=l.parentNode;return e(l&&"TABLE"==l.tagName?l:[])}return e([])}function Ee(a){if(a.altKey&&a.which==e.FE.KEYCODE.SPACE){var r,s=t.selection.element();if("TD"==s.tagName||"TH"==s.tagName?r=s:e(s).closest("td").length>0?r=e(s).closest("td").get(0):e(s).closest("th").length>0&&(r=e(s).closest("th").get(0)),r)return a.preventDefault(),H(r,r),l(),!1}}function Ce(a){var l=ve();if(l.length>0){var r,s,n=N(),o=a.which;1==l.length?(r=l[0],s=r):(r=t.el.querySelector(".fr-cell-fixed"),s=t.el.querySelector(".fr-cell-handler"));var i=S(s,n);if(e.FE.KEYCODE.ARROW_RIGHT==o){if(i.col<n[0].length-1)return H(r,n[i.row][i.col+1]),!1}else if(e.FE.KEYCODE.ARROW_DOWN==o){if(i.row<n.length-1)return H(r,n[i.row+1][i.col]),!1}else if(e.FE.KEYCODE.ARROW_LEFT==o){if(i.col>0)return H(r,n[i.row][i.col-1]),!1}else if(e.FE.KEYCODE.ARROW_UP==o&&i.row>0)return H(r,n[i.row-1][i.col]),!1}}function Re(){if(!t.$wp)return!1;if(!t.helpers.isMobile()){De=!1,Fe=!1,_e=!1,t.events.$on(t.$el,"mousedown",V),t.popups.onShow("image.edit",function(){k(),De=!1,Fe=!1}),t.popups.onShow("link.edit",function(){k(),De=!1,Fe=!1}),t.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&k()}),t.events.$on(t.$el,"mouseenter","th, td",U),t.events.$on(t.$win,"mouseup",X),t.opts.iframe&&t.events.$on(e(t.o_win),"mouseup",X),t.events.$on(t.$win,"mousemove",pe),t.events.$on(e(t.o_win),"scroll",ie),t.events.on("contentChanged",function(){ve().length>0&&(l(),t.$el.find("img").on("load.selected-cells",function(){e(this).off("load.selected-cells"),ve().length>0&&l()}))}),t.events.$on(e(t.o_win),"resize",function(){k()}),t.events.on("toolbar.esc",function(){if(ve().length>0)return t.events.disableBlur(),t.events.focus(),!1},!0),t.events.$on(t.$el,"keydown",function(e){e.shiftKey?!1===Ce(e)&&setTimeout(function(){l()},0):Z(e)}),t.events.on("keydown",function(a){if(!1===ue(a))return!1;var l=ve();if(l.length>0){if(l.length>0&&t.keys.ctrlKey(a)&&a.which==e.FE.KEYCODE.A)return k(),t.popups.isVisible("table.edit")&&t.popups.hide("table.edit"),l=[],!0;if(a.which==e.FE.KEYCODE.ESC&&t.popups.isVisible("table.edit"))return k(),t.popups.hide("table.edit"),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),l=[],!1;if(l.length>1&&a.which==e.FE.KEYCODE.BACKSPACE){t.undo.saveStep();for(var r=0;r<l.length;r++)e(l[r]).html("<br>"),r==l.length-1&&e(l[r]).prepend(e.FE.MARKERS);return t.selection.restore(),t.undo.saveStep(),l=[],!1}if(l.length>1&&a.which!=e.FE.KEYCODE.F10&&!t.keys.isBrowserAction(a))return a.preventDefault(),l=[],!1}else if(l=[],!1===Ee(a))return!1},!0);var a=[];t.events.on("html.beforeGet",function(){a=ve();for(var e=0;e<a.length;e++)a[e].className=(a[e].className||"").replace(/fr-selected-cell/g,"")}),t.events.on("html.afterGet",function(){for(var e=0;e<a.length;e++)a[e].className=(a[e].className?a[e].className.trim()+" ":"")+"fr-selected-cell";a=[]}),n(!0),c(!0)}t.events.on("destroy",ge)}var Oe,Ae,Fe,De,xe,ye,_e;return{_init:Re,insert:b,remove:g,insertRow:w,deleteRow:E,insertColumn:C,deleteColumn:R,mergeCells:x,splitCellVertically:_,splitCellHorizontally:y,addHeader:m,removeHeader:v,setBackground:M,showInsertPopup:a,showEditPopup:l,showColorsPopup:r,back:me,verticalAlign:I,horizontalAlign:$,applyStyle:T,selectedTable:we,selectedCells:ve}},e.FE.DefineIcon("insertTable",{NAME:"table"}),e.FE.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),e.FE.RegisterCommand("tableInsert",{callback:function(e,t,a){this.table.insert(t,a),this.popups.hide("table.insert")}}),e.FE.DefineIcon("tableHeader",{NAME:"header"}),e.FE.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(e){var t=this.table.selectedTable();t.length>0&&(0===t.find("th").length?e.removeClass("fr-active").attr("aria-pressed",!1):e.addClass("fr-active").attr("aria-pressed",!0))}}),e.FE.DefineIcon("tableRows",{NAME:"bars"}),e.FE.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below","delete":"Delete row"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableRows.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+="</ul>"},callback:function(e,t){"above"==t||"below"==t?this.table.insertRow(t):this.table.deleteRow()}}),e.FE.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90"}),e.FE.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after","delete":"Delete column"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableColumns.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+="</ul>"},callback:function(e,t){"before"==t||"after"==t?this.table.insertColumn(t):this.table.deleteColumn()}}),e.FE.DefineIcon("tableCells",{NAME:"square-o"}),e.FE.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableCells.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+="</ul>"},callback:function(e,t){"merge"==t?this.table.mergeCells():"vertical-split"==t?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(e,t){this.$el.find(".fr-selected-cell").length>1?(t.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):(t.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),t.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),e.FE.DefineIcon("tableRemove",{NAME:"trash"}),e.FE.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),e.FE.DefineIcon("tableStyle",{NAME:"paint-brush"}),e.FE.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(t,a){var l=this.$el.find(".fr-selected-cell").closest("table");l&&a.find(".fr-command").each(function(){var t=e(this).data("param1"),a=l.hasClass(t);e(this).toggleClass("fr-active",a).attr("aria-selected",a)})}}),e.FE.DefineIcon("tableCellBackground",{NAME:"tint"}),e.FE.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),e.FE.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(e,t){this.table.setBackground(t)}}),e.FE.DefineIcon("tableBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(e){0!==this.table.selectedCells().length||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v"}),e.FE.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableCellVerticalAlign.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'+l.toLowerCase()+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(l)+"</a></li>");return t+="</ul>"},callback:function(e,t){this.table.verticalAlign(t)},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.FE.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left"}),e.FE.DefineIcon("align-left",{NAME:"align-left"}),e.FE.DefineIcon("align-right",{NAME:"align-right"}),e.FE.DefineIcon("align-center",{NAME:"align-center"}),e.FE.DefineIcon("align-justify",{NAME:"align-justify"}),e.FE.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableCellHorizontalAlign.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.icon.create("align-"+l)+'<span class="fr-sr-only">'+this.language.translate(a[l])+"</span></a></li>");return t+="</ul>"},callback:function(e,t){this.table.horizontalAlign(t)},refresh:function(t){var a=this.table.selectedCells();a.length&&t.find("> *:first").replaceWith(this.icon.create("align-"+this.helpers.getAlignment(e(a[0]))))},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell:first"))+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.FE.DefineIcon("tableCellStyle",{NAME:"magic"}),e.FE.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableCellStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(t,a){var l=this.$el.find(".fr-selected-cell:first");l&&a.find(".fr-command").each(function(){var t=e(this).data("param1"),a=l.hasClass(t);e(this).toggleClass("fr-active",a).attr("aria-selected",a)})}}),e.FE.DefineIcon("tableColorRemove",{NAME:"eraser"})});