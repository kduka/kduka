!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n)}:e(window.jQuery)}(function(e){e.extend(e.FE.DEFAULTS,{lineBreakerTags:["table","hr","form","dl","span.fr-video"],lineBreakerOffset:15,lineBreakerHorizontalOffset:10}),e.FE.PLUGINS.lineBreaker=function(t){function n(e,n){var r,o,a,i,s,f,l,u;if(null==e)i=n.parent(),s=i.offset().top,l=n.offset().top,r=l-Math.min((l-s)/2,t.opts.lineBreakerOffset),a=i.outerWidth(),o=i.offset().left;else if(null==n)i=e.parent(),f=i.offset().top+i.outerHeight(),u=e.offset().top+e.outerHeight(),r=u+Math.min((f-u)/2,t.opts.lineBreakerOffset),a=i.outerWidth(),o=i.offset().left;else{i=e.parent();var p=e.offset().top+e.height(),g=n.offset().top;if(p>g)return!1;r=(p+g)/2,a=i.outerWidth(),o=i.offset().left}t.opts.iframe&&(o+=t.$iframe.offset().left-t.helpers.scrollLeft(),r+=t.$iframe.offset().top-t.helpers.scrollTop()),t.$box.append(m),m.css("top",r-t.win.pageYOffset),m.css("left",o-t.win.pageXOffset),m.css("width",a),m.data("tag1",e),m.data("tag2",n),m.addClass("fr-visible").data("instance",t)}function r(e,r){var a,i,s=e.offset().top,f=e.offset().top+e.outerHeight();if(Math.abs(f-r)<=t.opts.lineBreakerOffset||Math.abs(r-s)<=t.opts.lineBreakerOffset)if(Math.abs(f-r)<Math.abs(r-s)){i=e.get(0);for(var l=i.nextSibling;l&&l.nodeType==Node.TEXT_NODE&&0===l.textContent.length;)l=l.nextSibling;if(!l)return n(e,null),!0;if(a=o(l))return n(e,a),!0}else{if(i=e.get(0),!i.previousSibling)return n(null,e),!0;if(a=o(i.previousSibling))return n(a,e),!0}m.removeClass("fr-visible").removeData("instance")}function o(n){if(n){var r=e(n);if(0===t.$el.find(r).length)return null;if(n.nodeType!=Node.TEXT_NODE&&r.is(t.opts.lineBreakerTags.join(",")))return r;if(r.parents(t.opts.lineBreakerTags.join(",")).length>0)return n=r.parents(t.opts.lineBreakerTags.join(",")).get(0),0!==t.$el.find(n).length&&e(n).is(t.opts.lineBreakerTags.join(","))?e(n):null}return null}function a(n,r){var o=t.doc.elementFromPoint(n,r);return o&&!e(o).closest(".fr-line-breaker").length&&!t.node.isElement(o)&&o!=t.$wp.get(0)&&e(o).closest(t.$wp).length?o:null}function i(e,n,r){for(var o=r,i=null;o<=t.opts.lineBreakerOffset&&!i;)i=a(e,n-o),i||(i=a(e,n+o)),o+=r;return i}function s(e,n,r){for(var o=null;!o&&e>t.$box.offset().left&&e<t.$box.offset().left+t.$box.outerWidth();)o=a(e,n),o||(o=i(e,n,5)),"left"==r?e-=t.opts.lineBreakerHorizontalOffset:e+=t.opts.lineBreakerHorizontalOffset;return o}function f(e){b=null;var n=null,a=null,f=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset);f&&("HTML"==f.tagName||"BODY"==f.tagName||t.node.isElement(f)||(f.getAttribute("class")||"").indexOf("fr-line-breaker")>=0)?(a=i(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset,1),a||(a=s(e.pageX-t.win.pageXOffset-t.opts.lineBreakerHorizontalOffset,e.pageY-t.win.pageYOffset,"left")),a||(a=s(e.pageX-t.win.pageXOffset+t.opts.lineBreakerHorizontalOffset,e.pageY-t.win.pageYOffset,"right")),n=o(a)):n=o(f),n?r(n,e.pageY):t.core.sameInstance(m)&&m.removeClass("fr-visible").removeData("instance")}function l(e){return!(m.hasClass("fr-visible")&&!t.core.sameInstance(m))&&(t.popups.areVisible()||t.el.querySelector(".fr-selected-cell")?(m.removeClass("fr-visible"),!0):void(!1!==h||t.edit.isDisabled()||(b&&clearTimeout(b),b=setTimeout(f,30,e))))}function u(){b&&clearTimeout(b),m.hasClass("fr-visible")&&m.removeClass("fr-visible").removeData("instance")}function p(){h=!0,u()}function g(){h=!1}function d(n){if(!t.core.sameInstance(m))return!0;n.preventDefault(),m.removeClass("fr-visible").removeData("instance");var r=m.data("tag1"),o=m.data("tag2"),a=t.html.defaultTag();null==r?a&&"TD"!=o.parent().get(0).tagName&&0===o.parents(a).length?o.before("<"+a+">"+e.FE.MARKERS+"<br></"+a+">"):o.before(e.FE.MARKERS+"<br>"):a&&"TD"!=r.parent().get(0).tagName&&0===r.parents(a).length?r.after("<"+a+">"+e.FE.MARKERS+"<br></"+a+">"):r.after(e.FE.MARKERS+"<br>"),t.selection.restore()}function c(){t.shared.$line_breaker||(t.shared.$line_breaker=e('<div class="fr-line-breaker"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+t.language.translate("Break")+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect x="21" y="11" width="2" height="8"/><rect x="14" y="17" width="7" height="2"/><path d="M14.000,14.000 L14.000,22.013 L9.000,18.031 L14.000,14.000 Z"/></svg></a></div>')),m=t.shared.$line_breaker,t.events.on("shared.destroy",function(){m.html("").removeData().remove(),m=null},!0),t.events.on("destroy",function(){m.removeData("instance").removeClass("fr-visible").appendTo("body:first"),clearTimeout(b)},!0),t.events.$on(m,"mousemove",function(e){e.stopPropagation()},!0),t.events.$on(m,"mousedown","a",function(e){e.stopPropagation()},!0),t.events.$on(m,"click","a",d,!0)}function v(){if(!t.$wp)return!1;c(),h=!1,t.events.$on(t.$win,"mousemove",l),t.events.$on(e(t.win),"scroll",u),t.events.on("popups.show.table.edit",u),t.events.on("commands.after",u),t.events.$on(e(t.win),"mousedown",p),t.events.$on(e(t.win),"mouseup",g)}var m,h,b;return{_init:v}}});